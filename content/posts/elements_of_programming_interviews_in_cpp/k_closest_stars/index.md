---
title: 문제10.4 k개의 가까운 별 찾기
subTitle: k_closest_stars
category: algorithm
date: 2023-04-22T21:53:24
cover: ../cover.jpeg
---

# 문제

지구가 (0,0,0)의 위치에 있는 은하계를 상상해 보자. 별은 점으로 표현하고 거리는 광년으로 나타낸다고 가정하자. 은하계에는 대략 $10^{12}$개의 별이 존재하고 별들의 위치가 파일에 저장되어 있다고 하자.

지구와 가장 가까운 별 k개를 찾으려면 어떻게 해야 할까?

# 해법

만약 메모리의 제한이 없다면 모든 자료를 배열에 넣은 다음 정렬해서 k개의 원소를 찾으면 된다. $O(n)$의 공간 복잡도를 사용하는데 데이터의 개수가 굉장히 많은 경우에는 램에 모두 저장할 수 없다는 문제가 있다.

직관적으로 생각해 보면 지구와 가까이 위치한 별에만 집중하면 된다. 별의 위치에 따라 반복적으로 후보 집합을 갱신하고 필요한 후보 집합을 유지하면 되므로 최대힙을 사용한다.

```cpp
#include <bits/stdc++.h>
using namespace std;

struct Star {
    bool operator<(const Star& that) const {
        return Distance() < that.Distance();
    }

    double Distance() const { return sqrt(x * x + y * y + z * z); }
    double x, y, z;
};

vector<Star> FindClosestKStars(vector<Star>::const_iterator stars_begin,
                               const vector<Star>::const_iterator& stars_end,
                               int k) {
    priority_queue<Star> max_heap;

    while (stars_begin != stars_end) {
        max_heap.emplace(*stars_begin++);
        if (max_heap.size() > k) max_heap.pop();
    }

    vector<Star> closest_stars;
    while (!max_heap.empty()) {
        closest_stars.emplace_back(max_heap.top());
        max_heap.pop();
    }
    return {closest_stars.rbegin(), closest_stars.rend()};
}

int main() {
    vector<Star> test_case{
        {-8459.342386685723, 7537.164775490433, 2664.519275103283},
        {-5962.654503303675, 1499.1074152272158, 9371.71538476249},
        {-4916.366631287836, -4443.32515373953, -5881.2969560625315},
        {-4901.969389889855, 2492.1981628631565, -7639.189406340627},
        {7618.574621143194, -1467.190533714851, -1524.015094690778},
        {-8477.010432074396, 1360.0084577475118, 8323.906702204353},
        {912.7195365959997, -2957.4814473591023, -894.9655577942176},
        {-7270.874803146347, 444.79236420740017, -896.6413910030678},
        {2482.6853710044743, -2275.106739490451, 8968.384538221551},
        {-51.89241281227078, 5827.661704336142, 7642.678809358615},
        {-4245.301727022504, 8099.332046313502, 970.7336950804311},
        {1014.6444324974455, 5830.491868390076, 6228.248816569991},
        {6299.776177430267, 1136.3445094828076, 2892.5787230787646},
        {963.5601949151223, 5285.001746297645, 8241.347931314765},
        {6254.4924167176905, -8002.919474937023, 4747.481337353616},
        {2939.6835771656097, -3.262267750349565, -7218.16201162566},
        {-363.30860487324753, 6123.036058336442, -2257.882730186385},
        {5640.490723867002, 3949.7441717595575, -7380.5612153435995},
        {6245.912664580053, -8594.781230770352, -1763.9209079979264},
        {6792.95987884876, -9757.884641393295, -9957.811790736752},
        {-7903.076240167082, -8396.07192237413, -9875.196554289505},
        {-1632.0552148659099, -8777.725105930518, 8325.776768711028}};
    auto res = FindClosestKStars(test_case.begin(), test_case.end(), 13);
    for (auto e : res) {
        cout << e.Distance() << endl;
    }
    return 0;
}
```

```markdown lineNumbers=true
3221.91
6536.18
7024.63
7339.44
7793.82
7906.83
8591.58
8860.22
9195.87
9412.63
9579.76
9611.18
9837.66
```

## 응용: n개의 원소로 이루어진 시퀀스를 차례대로 읽는다. k번째 원소부터 시작해서 현재까지의 원소 중 k번째로 큰 원소가 무엇인지 출력하는 알고리즘을 설계하라.

단, 시간 복잡도는 $O(nlogk)$여야 한다. 시퀀스의 길이는 미리 알지 못한다. $O(k)$보다 많은 공간을 사용할 수 없다. 이 알고리즘의 최악의 입력은 무엇인가?

```cpp
void PrintKStar(vector<Star>::const_iterator stars_begin,
                const vector<Star>::const_iterator& stars_end, int k) {
    priority_queue<Star> max_heap(stars_begin, stars_begin + k);
    std::advance(stars_begin, k);

    while (stars_begin != stars_end) {
        cout << max_heap.top().Distance() << endl;
        if (max_heap.top().Distance() > stars_begin->Distance()) {
            max_heap.pop();
            max_heap.emplace(*stars_begin);
        }

        stars_begin++;
    }
}
```

```markdown lineNumbers=true
all starts print
11639.1
11208.5
8860.22
9412.63
7906.83
11958.1
3221.91
7339.44
9579.76
9611.18
9195.87
8591.58
7024.63
9837.66
11211.8
7793.82
6536.18
10094
10770
15508.7
15181.3
12207.8

k print star
11639.1
11639.1
11208.5
9412.63
9412.63
9412.63
9195.87
8860.22
8591.58
8591.58
8591.58
7906.83
7793.82
7793.82
7793.82
7793.82
7793.82
```
